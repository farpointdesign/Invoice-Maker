<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f6f8;
      color: #333;
    }
    .form-block {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }
    .form-block label {
      display: flex;
      flex-direction: column;
      font-weight: bold;
      font-size: 14px;
    }
    .form-block input,
    .form-block textarea {
      margin-top: 5px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    .form-buttons {
      grid-column: 1 / -1;
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    .invoice-section {
      width: 612pt;
      max-width: 800px;
      margin: auto;
      background-color: #fff;
      padding: 25px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      border: 1px solid #c0d4ef;
      min-height: 792pt;
      height: 792pt;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .invoice-main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding-bottom: 10px;
      margin-bottom: 20px;
      border-bottom: 3px solid #1e90ff;
    }
    .header-title {
      font-size: 36px;
      font-weight: bold;
      color: #1e90ff;
      letter-spacing: 1px;
    }
    .header-address {
      text-align: right;
      font-size: 14px;
      line-height: 1.4;
    }
    .section {
      margin-bottom: 15px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 10px;
      text-align: left;
    }
    th {
      background-color: #e2efff;
    }
    .footer-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-top: 30px;
    }
    .footer-row p {
      margin: 0;
      font-size: 13px;
      line-height: 1.4;
    }
    #venmoQrCode canvas {
      width: 80px !important;
      height: 80px !important;
    }
    button {
      padding: 10px 15px;
      font-weight: bold;
      background-color: #1e90ff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0078d4;
    }
    @media print {
      .form-block {
        display: none;
      }
      .invoice-section {
        display: block !important;
      }
      body {
        background: white;
        color: black;
      }
      th {
        background-color: #ddd !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <div class="form-block">
    <label>Bill To:
      <textarea id="billTo">Client Name
123 Street
City, ST ZIP</textarea>
    </label>
    <label>Invoice #:
      <input type="text" id="invoiceNo" value="001">
    </label>
    <label>Issue Date:
      <input type="date" id="issueDate">
    </label>
    <label>Due Date:
      <input type="date" id="dueDate">
    </label>
    <label>Project Description:
      <input type="text" id="description" value="Bathroom Remodel">
    </label>
    <label>Tasks (format: Task - Hours):
      <textarea id="taskList">Demo tile - 4
Install tile - 6</textarea>
    </label>
    <label>Hourly Rate:
      <input type="number" id="hourlyRate" value="75">
    </label>
    <label>Materials Cost:
      <input type="number" id="materialsCost" value="250">
    </label>
    <label>Amount Paid:
      <input type="number" id="amountPaid" value="0">
    </label>
    <div class="form-buttons">
      <button onclick="updateInvoiceOnly()">Generate</button>
      <button onclick="savePDF()">Create PDF</button>
    </div>
  </div>

  <div class="invoice-section" id="invoiceSection">
    <div class="invoice-main">
      <div class="header">
        <div class="header-title">INVOICE</div>
        <div class="header-address" id="senderAddress">Jabrial Gentry<br>PO Box 823<br>Heber City, UT 84032</div>
      </div>
      <div class="section" id="billToSection"></div>
      <div class="section" id="invoiceMeta"></div>
      <div class="section" id="projectDescription"></div>
      <div class="section">
        <table id="tasksTable">
          <thead><tr><th>Task</th><th>Hours</th><th>Cost</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="section">
        <table>
          <tbody id="totals"></tbody>
        </table>
      </div>
    </div>
    <div class="footer-row">
      <p>Make checks payable to:<br><strong id="footerName">Jabrial Gentry</strong></p>
      <div style="text-align:center;">
        <div id="venmoQrCode"></div>
        <div style="font-size:12px; margin-top:5px;">Venmo</div>
      </div>
    </div>
  </div>
  <script>
  function updateInvoiceOnly() {
    document.getElementById('billToSection').innerHTML = "<strong>Bill To:</strong><br>" + document.getElementById('billTo').value.replace(/\n/g, "<br>");
    document.getElementById('invoiceMeta').innerHTML = "<strong>Invoice #: </strong>" + document.getElementById('invoiceNo').value +
      "<br><strong>Issue Date: </strong>" + document.getElementById('issueDate').value +
      "<br><strong>Due Date: </strong>" + document.getElementById('dueDate').value;
    document.getElementById('projectDescription').innerHTML = "<strong>Description:</strong> " + document.getElementById('description').value;

    const taskList = document.getElementById('taskList').value.trim().split('\n');
    const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
    const materialsCost = parseFloat(document.getElementById('materialsCost').value);
    const amountPaid = parseFloat(document.getElementById('amountPaid').value);
    let tasksHtml = '';
    let totalHours = 0;

    taskList.forEach(task => {
      const parts = task.split(' - ');
      const name = parts[0];
      const hours = parseFloat(parts[1]) || 0;
      const cost = hours * hourlyRate;
      totalHours += hours;
      tasksHtml += `<tr><td>${name}</td><td>${hours}</td><td>$${cost.toFixed(2)}</td></tr>`;
    });

    document.querySelector('#tasksTable tbody').innerHTML = tasksHtml;

    const laborCost = totalHours * hourlyRate;
    const totalDue = laborCost + materialsCost;
    const balance = totalDue - amountPaid;

    document.getElementById('totals').innerHTML = `
      <tr><td><strong>Total Hours</strong></td><td colspan="2">${totalHours}</td></tr>
      <tr><td><strong>Hourly Rate</strong></td><td colspan="2">$${hourlyRate.toFixed(2)}</td></tr>
      <tr><td><strong>Labor</strong></td><td colspan="2">$${laborCost.toFixed(2)}</td></tr>
      <tr><td><strong>Materials</strong></td><td colspan="2">$${materialsCost.toFixed(2)}</td></tr>
      <tr><td><strong>Total</strong></td><td colspan="2">$${totalDue.toFixed(2)}</td></tr>
      <tr><td><strong>Amount Paid</strong></td><td colspan="2">$${amountPaid.toFixed(2)}</td></tr>
      <tr><td><strong>Balance Due</strong></td><td colspan="2">$${balance.toFixed(2)}</td></tr>
    `;

    document.getElementById('footerName').innerText = "Jabrial Gentry";

    // Regenerate QR code
    const qrContainer = document.getElementById('venmoQrCode');
    qrContainer.innerHTML = '';
    new QRCode(qrContainer, {
      text: "https://venmo.com/u/CrawdadthePinchy",
      width: 80,
      height: 80
    });
  }

  function savePDF() {
    updateInvoiceOnly();
    const invoice = document.getElementById('invoiceSection');
    html2canvas(invoice, { scale: 2 }).then(canvas => {
      const imgData = canvas.toDataURL('image/jpeg', 1.0);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'pt', 'letter');
      pdf.addImage(imgData, 'JPEG', 0, 0, 612, 792);
      pdf.save(`Invoice_${document.getElementById('invoiceNo').value || '000'}.pdf`);
    });
  }

  window.onload = updateInvoiceOnly;
</script>
</body>
</html>
